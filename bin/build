#!/usr/bin/env ruby

def usage
  puts <<-EOS
  #{File.basename(__FILE__)} <project-name> <platform-name> [options]
  Options:
    target - where to build the project (defaults to grabbing one from the pooler)
    preserve - whether to tear down the vm on success or not (defaults to false)
EOS
end

project = ARGV[0]
platform = ARGV[1]
target = ARGV[2]
preserve = ARGV.include?("--preserve")
verbose = ARGV.include?("-v")
configdir = File.join(Dir.pwd, "configs")

if project.nil? or platform.nil?
  STDERR.puts "project and platform are both required arguments."
  usage
  exit 1
end

load File.expand_path(File.join(File.dirname(__FILE__), "..", "lib", "vanagon.rb"))
artifact = Vanagon.new(platform, project, configdir)
artifact.run(target, preserve, verbose)
