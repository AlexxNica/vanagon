<?xml version="1.0" encoding="windows-1252"?>
<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi" xmlns:util="http://schemas.microsoft.com/wix/UtilExtension">
  <Product
    Id="*"
    UpgradeCode="<%= settings[:upgrade_code] %>"
    Name="<%= settings[:product_name] %>"
    Language="1033"
    Codepage="1252"
    Version="<%= @version.sub(/\.g[0-9a-z]{7}$/, '') %>"
    Manufacturer="<%= settings[:company_name] %>" >

    <Package
      InstallerVersion="300"
      InstallScope="perMachine"
      Description="<%= "#{settings[:product_word]}#{@platform.architecture == "x64" ? " (64-bit)" : ""}" %> Installer"
      Comments="<%= @homepage %>"
      Compressed="yes"
      Platform="<%= @platform.architecture %>"
    />

    <MajorUpgrade AllowDowngrades="yes" />
    <Media Id="1" Cabinet="<%= settings[:product_word] %>.cab" EmbedCab="yes" CompressionLevel="high" />

    <Feature Id="<%= settings[:product_word] %>Runtime" Title="<%= settings[:product_word] %> Runtime" Level="1">
      <!-- We can add all components by referencing this one thing -->
      <ComponentGroupRef Id="ProductComponentGroup" />
    </Feature>

    <!-- We will use DirectoryRef at the project level to hook in the project directory structure -->
    <Directory Id='TARGETDIR' Name='SourceDir' >
      <Component Id="RegistryEntriesArchitectureDependent" Guid="E6D5AF4F-ACC4-4D11-AFCE-299A9ED2152C" Win64="<%= settings[:win64] %>" Permanent="yes">
        <RegistryKey Root="HKLM" Key="SOFTWARE\<%= settings[:company_name] %>\<%= settings[:product_name] %>" ForceCreateOnInstall="yes" >
          <RegistryValue Type="integer" Value="0"/>
          <%- if @platform.architecture == "x64" -%>
          <RegistryValue Name="RememberedInstallDir" Type="string" Value="[INSTALLDIR_X86]" />
          <RegistryValue Name="RememberedInstallDir64" Type="string" Value="[INSTALLDIR]" KeyPath="yes" />
          <%- else %>
          <RegistryValue Name="RememberedInstallDir" Type="string" Value="[INSTALLDIR]"  KeyPath="yes" />
          <%- end -%>
        </RegistryKey>
      </Component>
    </Directory>

  </Product>
</Wix>
