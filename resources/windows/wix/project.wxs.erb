<?xml version="1.0" encoding="windows-1252"?>
<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi" xmlns:util="http://schemas.microsoft.com/wix/UtilExtension">
  <Product
    Id="*"
    UpgradeCode="<%= settings[:upgrade_code] %>"
    Name="<%= settings[:product_name] %>"
    Language="1033"
    Codepage="1252"
    Version="<%= @version.sub(/\.g[0-9a-z]{7}$/, '') %>"
    Manufacturer="<%= settings[:company_name] %>" >

    <Package
      InstallerVersion="300"
      InstallScope="perMachine"
      Description="<%= "#{settings[:product_id]}#{@platform.architecture == "x64" ? " (64-bit)" : ""}" %> Installer"
      Comments="<%= @homepage %>"
      Compressed="yes"
      Platform="<%= @platform.architecture %>" />

      <!--  We are discussing a MAINT PR to move the componentfilegroup to seperate file
            This would allow project to specify additional fragments if needed -->

    <MajorUpgrade AllowDowngrades="yes" />
    <Media Id="1" Cabinet="<%= settings[:product_id] %>.cab" EmbedCab="yes" CompressionLevel="high" />

    <Feature Id="<%= settings[:product_id] %>Runtime" Title="<%= settings[:product_id] %> Runtime" Level="1">
      <!-- We can add all components by referencing this one thing -->
      <ComponentGroupRef Id="AppComponentGroup" />
      <ComponentGroupRef Id="AppDataComponentGroup" />
      <ComponentGroupRef Id="RegistryComponentGroup" />
      <%- get_services.each do |service| -%>
      <ComponentGroupRef Id="<%= service.component_group_id %>" />
      <%- end -%>
      <!-- All of these Include refs are expected to be present -->
      <ComponentGroupRef Id="FragmentProperties" />
      <ComponentGroupRef Id="FragmentSequences" />
      <ComponentGroupRef Id="FragmentCustomActions" />
    </Feature>
    <!-- We will use DirectoryRef at the project level to hook in the project directory structure -->
    <Directory Id='TARGETDIR' Name='SourceDir' />

  </Product>
</Wix>
